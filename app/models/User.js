var mongoose     = require( 'mongoose' )
  , findOrCreate = require( 'mongoose-findorcreate' )
  , uniqueValidator = require('mongoose-unique-validator');;

module.exports = function ( app )
{
	var schemaAddress = mongoose.Schema({
		city:{
			type: 'ObjectId' , ref: 'Cities'
		},
		district: 'String',
		number:   'String',
		street:   'String'
	});

	var schema = mongoose.Schema({
	 	login: { 
	 		type: 'String', 
	 		unique: true, 
	 		required: [ true , 'Login is required' ]
	 	},
	 	name: {
	 		type: 'String', 
	 		required: true
	 	},
	 	email: {
	 		type: 'String',
	 		required: [ true , 'Email is required' ]
	 	},
	 	phone: 'String',
	 	url:   'String',
	 	provider: 'String',
	 	active: 'Boolean',
	 	type: {
	 		type: 'Number',
	 		default: 1        // 1- user , 2- professional, 3 - admin
	 	},
	 	password: 'String',
	 	address: schemaAddress,
	 	image: {
	 		type: 'String',
	 		default: 'data:image/jpeg;base64,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'
	 	},
	 	inclusao: {
	 		type: Date,
	 		default: Date.now
	 	}
	});

	schema.plugin( findOrCreate );
	schema.plugin(uniqueValidator, { message: 'Login: {VALUE} already exstis in users' } );
	return mongoose.model( 'User', schema );
}